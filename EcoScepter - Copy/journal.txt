[INIT] Project initialized.
Environment: WSL2 Ubuntu 22.04, Python 3.11 (conda).
Editor: VS Code (Remote WSL).
Goal: Streamlit-based deforestation & vegetation degradation detection.
Constraints:
- Same-month multi-year imagery (seasonal bias removed).
- Strictly user-triggered execution.
- No automatic computation or file output.
Status: Structure initialized. No logic implemented yet.

[STEP 2] Implemented core utilities.
- Added scripts/io.py with raster loading and band order assumptions.
- Added scripts/visualize.py with percentile stretch for visualization.
Reason: Isolate stable, side-effect-free utilities from analysis logic.
Status: No computation triggered on import. No file output.

[STEP 3] Implemented spectral indices.
- Added NDVI, MNDWI, NDBI as pure signal functions.
- Added safe_div for NaN-safe computation.
Reason: Separate signal generation from masking and decision logic.
Status: No thresholds, no masking, no execution side effects.

[STEP 4] Implemented masking logic.
- Added valid data mask to exclude NaN/inf pixels.
- Added MNDWI-based water mask (irreversible exclusion).
- Added generic mask application utility.
Reason: Centralize pixel exclusion before any change detection.
Status: Masking only; no thresholds or decisions applied.

[STEP 5] Implemented temporal change logic.
- Added delta computation for inter-annual comparison.
- Added optional pixel-wise NDVI slope (non-default).
- Added normalized composite change score (ΔNDVI + ΔNDBI).
Reason: Represent vegetation loss as a continuous signal before thresholding.
Status: No classification or thresholds applied.

[STEP 6] Implemented thresholding and tuning logic.
- Added distribution-based auto baseline threshold.
- Added bounded aggressiveness-to-threshold mapping.
- Added explicit threshold application utility.
Reason: Enable robust, user-controlled decision boundaries without fixed constants.
Status: Thresholding only; no persistence or UI coupling.

[STEP 7] Implemented Streamlit interface.
- Added button-driven execution for scoring and thresholding.
- Enforced zero computation on app load.
- All intermediates stored in session state.
- No file output or persistence implemented.
Reason: Guarantee explicit user control and prevent side effects.
Status: End-to-end pipeline functional and disciplined.

[STEP 8] Implemented vegetation assessment core.
- Added scripts/assessment.py for per-image vegetation health analysis.
- Includes NDVI, MNDWI, NDBI computation and auto-threshold helpers.
- Produces continuous vegetation health score (no classification).
Reason: Separate per-image assessment from temporal deforestation logic.
Status: Logic-only module, no UI or file output.

[STEP 9] Extended Streamlit UI with assessment workflow.
- Added tab-based UI separating assessment and deforestation detection.
- Implemented per-TIFF vegetation health assessment with auto + slider thresholds.
- Enabled user-tuned color mapping for assessment (visual only).
- Preserved existing deforestation logic unchanged.
Reason: Support independent per-image assessment alongside change detection.
Status: User-triggered execution only; no file output.

[BUGFIX] Fixed vegetation overlay shape mismatch.
- Error caused by stacking 2D arrays with scalar during boolean assignment.
- Resolved by constructing full (H, W, 3) vegetation RGB layer before masking.
Reason: NumPy stack requires identical input shapes.
Status: Assessment visualization now renders correctly.

[STEP 10] Improved vegetation assessment visualization.
- Enforced water > clear land > vegetation mask precedence.
- Added 5-class vegetation health visualization.
- Added user-selectable visualization layers (RGB, NDVI, MNDWI, NDBI, Assessment).
- Visualization-only changes; computation unchanged.
Status: Assessment UI more interpretable and robust.

[UI FIX] Improved assessment visualization UX.
- Replaced NDVI visualization with perceptually ordered heatmap.
- Hid threshold sliders unless Vegetation Assessment view is active.
- Preserved auto-threshold behavior for other visualization modes.
Reason: Reduce UI clutter and improve interpretability.
Status: Visualization-only changes; analysis logic untouched.

[BUGFIX] Fixed Streamlit image width error.
- Replaced invalid width="100%" with width="stretch" in st.image calls.
Reason: Streamlit width parameter only accepts int, "stretch", or "content".
Status: UI renders correctly without deprecation warnings or runtime errors.

[STEP 11] Added automatic threshold tuning for vegetation assessment.
- Derived water, clear-land, and vegetation class thresholds from data percentiles.
- Reverse-engineered manual expert tuning into reproducible logic.
Reason: Eliminate trial-and-error while preserving RGB-consistent interpretation.
Status: Auto-tuning with optional user override.

[STEP 12] Made heatmaps threshold-aware.
- NDVI, MNDWI, NDBI visualizations now respect assessment thresholds.
- Contrast stretching applied only on meaningful pixel subsets.
Reason: Match expert-style high-contrast interpretation used in demo notebook.
Status: Visualization improved; analysis logic unchanged.

[STEP 13] Separated raw heatmaps from assessment logic.
- Restored NDVI, MNDWI, NDBI as independent diagnostic visualizations.
- Removed threshold influence from raw heatmaps.
- Kept thresholds exclusive to vegetation assessment map.
Reason: Preserve correct interpretation of spectral indices.
Status: Visual semantics corrected.

[STEP 14] Fixed raw heatmap normalization.
- Replaced percentile stretch with symmetric normalization for NDVI/MNDWI/NDBI.
- Preserved index sign and physical meaning.
Reason: Spectral indices are bounded and must not be contrast-stretched like RGB.
Status: Raw heatmaps now match expected EO behavior.

[BUGFIX] Sanitized image arrays before Streamlit rendering.
- Replaced NaN/Inf values with 0 prior to st.image calls.
- Ensured all images are clipped to [0,1] float32.
Reason: Streamlit cannot render NaN values and fails during uint8 casting.
Status: Image rendering stabilized.

[FIX] Restored notebook-faithful heatmaps in Streamlit
- Issue: NDVI/MNDWI/NDBI looked correct in notebook but inconsistent in app.
- Cause: Visualization mismatch (percentile stretch + cmap vs symmetric normalization + manual RGB).
- Fix: Added index_to_rgb() using notebook-style stretch and matplotlib colormaps.
- Change: Replaced manual RGB heatmap construction in app.py.
- Scope: Visualization-only; no analysis, masking, or threshold logic touched.
- Result: Raw heatmaps now visually identical to notebook output.
- Status: FIXED and stabilized.
